except both functions are much shorter now after the refactoring.