This solution still has some issues.