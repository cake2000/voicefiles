you simply need to update the "get end state distance" function.