I have translated the calculation into this JavaScript function.