Note that the calculate C T P function is asynchronous,