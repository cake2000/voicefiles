There are several ways to accelerate this function.