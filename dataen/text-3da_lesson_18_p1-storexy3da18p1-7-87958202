Do you have any good ideas to simplify this program?