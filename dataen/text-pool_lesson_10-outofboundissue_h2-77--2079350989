This is the full working code for exercise 6.