Here is the working code with the new function added.