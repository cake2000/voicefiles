For a hint, this is the main logic for the new block.