Here is an example program for Dee's hat.