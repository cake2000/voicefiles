Here is the code after refactoring.