First, calculate the end state for the command,