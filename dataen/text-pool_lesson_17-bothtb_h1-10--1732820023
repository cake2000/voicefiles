Lastly, you should calculate the success probability right before the return statement.