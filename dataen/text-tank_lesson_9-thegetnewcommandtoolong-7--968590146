To solve this problem, we need to "refactor" this function,