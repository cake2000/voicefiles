Here is a working version of both functions.