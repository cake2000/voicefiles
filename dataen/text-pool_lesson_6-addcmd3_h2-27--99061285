Here is the working code after the fix.