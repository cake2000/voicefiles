please add the logic for recalculating "y diff" considering the portal.