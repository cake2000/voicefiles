using a new variable "last upgrade type".