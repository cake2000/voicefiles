Let's go through the new logic flow of this function first. 