This is the full working code.