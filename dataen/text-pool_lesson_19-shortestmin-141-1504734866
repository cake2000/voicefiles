you only need to change the "get end state distance" function,