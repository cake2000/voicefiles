For a hint, here is the new logic for selecting the escape direction.